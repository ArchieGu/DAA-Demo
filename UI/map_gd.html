<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>航迹显示</title>
    <style>
        html,
        body,
        #container {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
    <div id="container" class="container"></div>
    <script src="https://webapi.amap.com/maps?v=1.4.15&key=035906e992c7d45a07deae1f56a91220&"></script>
    <script src="https://webapi.amap.com/loca?v=1.3.0&key=035906e992c7d45a07deae1f56a91220"></script>
    <script src="https://a.amap.com/Loca/static/dist/jquery.min.js"></script>
    <!-- UI组件库 1.0 -->
    <script src="https://webapi.amap.com/ui/1.0/main.js?v=1.0.11"></script>
    <script type="text/javascript"> 
        var map = new AMap.Map('container', {
            center: [116.397428, 39.90923],
            zoom: 4,
            layers: [
                // 卫星
                new AMap.TileLayer.Satellite(),
                // 路网
                new AMap.TileLayer.RoadNet()
            ]
        });

        var markers = []  //所有点标记
        var texts = []     //所有文本标记
        var polylines = []  //所有航路

        function removeMarkers() {
            //删除所有点标记和线标记
            map.remove(markers)
            map.remove(polylines)
            map.remove(texts)
        }


        map.on('mapload', function () {
            map.getMap().plugin(['AMap.ControlBar'], function () {
                var controlBar = new AMap.ControlBar();
                map.getMap().addControl(controlBar);
            });
        });
        //禁飞区显示
      
        $.getJSON('https://raw.githubusercontent.com/ArchieGu/TCAS-simulator/master/pos_gd.json', function (data) {
            var layer = new Loca.PolygonLayer({
                map: map,
                fitView: true
            });

            layer.setData(data, {
                type: 'json',
                lnglat: 'POS',
            });

            var idx = 0;
            layer.setOptions({
                style: {
                    height:200000,
                    opacity: 0.8,
                    color: '#930000'
                }
            });
            layer.render();
        });

        AMapUI.load(['ui/misc/PathSimplifier', 'lib/$'], function(PathSimplifier, $) {

            if (!PathSimplifier.supportCanvas) {
                alert('当前环境不支持 Canvas！');
                return;
            }

            //just some colors
            var colors = [
                "#3366cc", "#dc3912", "#ff9900", "#109618", "#990099", "#0099c6", "#dd4477", "#66aa00",
                "#b82e2e", "#316395", "#994499", "#22aa99", "#aaaa11", "#6633cc", "#e67300", "#8b0707",
                "#651067", "#329262", "#5574a6", "#3b3eac"
            ];

            var pathSimplifierIns = new PathSimplifier({
                zIndex: 100,
                //autoSetFitView:false,
                map: map, //所属的地图实例

                getPath: function(pathData, pathIndex) {

                    return pathData.path;
                },
                getHoverTitle: function(pathData, pathIndex, pointIndex) {

                    if (pointIndex >= 0) {
                        //point 
                        return pathData.name + '，点：' + pointIndex + '/' + pathData.path.length;
                    }

                    return pathData.name + '，点数量' + pathData.path.length;
                },
                renderOptions: {
                    pathLineStyle: {
                        dirArrowStyle: true
                    },
                    getPathStyle: function(pathItem, zoom) {

                        var color = colors[pathItem.pathIndex % colors.length],
                            lineWidth = Math.round(4 * Math.pow(1.1, zoom - 3));

                        return {
                            pathLineStyle: {
                                strokeStyle: color,
                                lineWidth: lineWidth
                            },
                            pathLineSelectedStyle: {
                                lineWidth: lineWidth + 2
                            },
                            pathNavigatorStyle: {
                                fillStyle: color
                            }
                        };
                    }
                }
            });

            window.pathSimplifierIns = pathSimplifierIns;

            $('<div id="loadingTip">加载数据，请稍候...</div>').appendTo(document.body);

            //$.getJSON('https://raw.githubusercontent.com/ArchieGu/TCAS-simulator/master/path.json', function(d) {
            function getPathData(pathDict){
                $('#loadingTip').remove();

                pathSimplifierIns.setData(pathDict);

                //initRoutesContainer(d);

                function onload() {
                    pathSimplifierIns.renderLater();
                }

                function onerror(e) {
                    alert('图片加载失败！');
                }

                var navg1 = pathSimplifierIns.createPathNavigator(0, {
                    loop: true,
                    speed: 10000,
                    pathNavigatorStyle: {
                        width: 24,
                        height: 24,
                        //使用图片
                        content: PathSimplifier.Render.Canvas.getImageContent('https://webapi.amap.com/ui/1.0/ui/misc/PathSimplifier/examples/imgs/plane.png', onload, onerror),
                        strokeStyle: null,
                        fillStyle: null,
                        //经过路径的样式
                        pathLinePassedStyle: {
                            lineWidth: 3,
                            strokeStyle: 'black',
                            dirArrowStyle: {
                                stepSpace: 15,
                                strokeStyle: 'red'
                            }
                        }
                    }
                });

                navg1.start();
            }//});
        });



/*        
        ///更新本机位置
        function update_own_position(lng,lat,angle){
            eval("window.marker_ownship.setPosition(["+lng+","+lat+"])")
            eval("window.marker_ownship.setAngle("+angle+")")
            window.text_ownship.setPosition([lng,lat])
        }
        /// 配置本机
        function init_ownship(first_lng,first_lat,flight_ID,path){
            window.marker_ownship = new AMap.Marker(
            {
                position: new AMap.LngLat(first_lng,first_lat),
                offset: new AMap.Pixel(-10,-10),
                icon: 'https://webapi.amap.com/ui/1.0/ui/misc/PathSimplifier/examples/imgs/plane.png', // 添加 Icon 图标 URL
                title: '本机',
            });
            
            // 创建纯文本标记
            window.text_ownship = new AMap.Text({
            text: flight_ID,
            cursor:'pointer',
            offset: new AMap.Pixel(0, 30),
            angle:0,
            style:{
                'padding': '0rem 0rem',
                'margin-bottom': '.25rem',
                'border-radius': '.25rem',
                'background-color': 'white',
                'width': '4rem',
                'border-width': 0,
                'box-shadow': '0 2px 6px 0 rgba(114, 124, 245, .5)',
                'text-align': 'center',
                'font-size': '12px',
                'color': 'blue'
            },
            position: [first_lng,first_lat]
            });
            map.add(window.marker_ownship)
            map.add(window.text_ownship)
            markers.push(window.marker_ownship)
            texts.push(window.text_ownship)
            //设置本机航路
            var polyline_own = new AMap.Polyline({
            isOutline: true,
            outlineColor: '#ffeeff',
            borderWeight: 2,
            strokeColor: "#3366FF",
            strokeOpacity: 1,
            strokeWeight: 3,
            // 折线样式还支持 'dashed'
            strokeStyle: "solid",
            // strokeStyle是dashed时有效
            strokeDasharray: [10, 5],
            lineJoin: 'round',
            lineCap: 'round',
            zIndex: 50,
            });
            var path_own= path;
            polyline_own.setPath(path_own);
            polyline_own.setMap(map);
            map.setFitView([polyline_own]);
            polylines.push(polyline_own)
        }
*/
    </script>
</body>

</html>